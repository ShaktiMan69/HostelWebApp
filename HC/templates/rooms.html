{% extends 'base.html' %}
{% block content %}

<div id="rooms_data" data="{{ rooms_info | safe }}">
  <!-- JSON data will be displayed here -->
</div>

<!-- Modal -->
<div class="modal fade" id="M" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog  modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Room Photos</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100" src="" alt="First slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="" alt="Second slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="" alt="Third slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="" alt="Fourth slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="" alt="Fifth slide">
            </div>
          </div>
          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .modal-open, body {overflow: inherit !important;}

  .modal-dialog {
  max-width: max-content !important;
  }

  .modal-body {
    display: flex;
  }

  .modal-body img {
    object-fit: contain;
  }


</style>
<script>
  $(function(){
    var current = location.pathname;
    var ulChildren = document.getElementsByClassName('nav')[0].children;                
    var childrenLength = ulChildren.length;

    for (var i = 0; i < childrenLength; i++) {
      if (ulChildren[i].children[0].getAttribute('href') === current) {
        ulChildren[i].classList.add('active');
      }
    }
})

</script>
<style>
  * {
    font-family: "Inter", sans-serif;
    font-optical-sizing: auto;
    font-style: normal;
    font-variation-settings: "slnt" 0;
  }

  .room-btn {
    width: 50px !important;
    border-radius: 10px;
    outline: none;
    border: 0;
    padding: 2em 4em;
    display: inline-flex;
    justify-content: center;
  }

  .gender-card:hover {
    cursor: pointer;
  }

</style>
<div class="container">
  <div class="container tw-bg-blue-500 tw-rounded-lg px-5 py-3 text-light text-center my-3" style="max-width: 700px">
    <h3 class="my-3 tw-text-3xl tw-font-semibold">Rooms</h3>
    <div
    class="gender-select tw-gap-5 md:tw-gap-10 tw-flex tw-flex-col md:tw-flex-row md:tw-items-center"
  >
    <div
      id="boys"
      class="tw-transition-colors tw-duration-300 [&.active]:tw-bg-gradient-to-br tw-from-green-500 tw-via-green-600 tw-to-green-700 hover:tw-bg-green-200 [&.active]:tw-text-white gender-card card col p-5 tw-rounded-lg tw-font-semibold tw-text-xl"
      style="color: black;"
    >
      BOYS HOSTEL
    </div>
    <div
      id="girls"
      class="tw-transition-colors tw-duration-300 [&.active]:tw-bg-gradient-to-br tw-from-pink-500 tw-via-pink-600 tw-to-pink-700 hover:tw-bg-pink-200 [&.active]:tw-text-white gender-card card col p-5 tw-rounded-lg tw-font-semibold tw-text-xl"
      style="color: black;"
    >
      GIRLS HOSTEL
    </div>
  </div>
    <div id="drops" class="mt-4">

      <div id="id-boys" class="mb-2 form-floating" style="display: none">
        <select class="form-select" aria-label="Boys Hostel Room">
          <option value="0">ID1</option>
          <option value="2">ID2</option>
          <option value="4">ID3</option>
        </select>
        <label class="text-dark" for="floor">Select ID</label>
      </div>
      <div id="id-girls" class="mb-2 form-floating" style="display: none">
        <select class="form-select" aria-label="Girls Hostel Room">
          <option value="6">ID4</option>
          <option value="8">ID5</option>
        </select>
        <label class="text-dark" for="floor">Select ID</label>
      </div>
      <div id="floor" class="mb-2 form-floating"  style="display: none">
        <select class="form-select" aria-label="Select Floor">
          <option value="0">Ground Floor</option>
          <option value="1">First Floor</option>
        </select>
        <label class="text-dark" for="floor">Select Floor</label>
      </div>
      <div class="d-grid gap-2">
        <button class="btn btn-success" type="button" id="getDetails" style="display: none" >Get Details</button>
      </div>
    </div>
  </div>
  <div
  class="container tw-bg-gray-300 tw-rounded-lg p-2 text-light text-center"
  style="max-width: 700px"
>
    <div class="container text-center">
      <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-3 tw-gap-5"  id="rooms_grid">
        <div>
          <button
            type="button"
            class="btn tw-bg-gradient-to-r tw-from-green-500 tw-via-green-600 tw-to-green-700 hover:tw-bg-gradient-to-br tw-text-white tw-font-medium disabled:tw-from-red-400 disabled:tw-via-red-500 disabled:tw-to-red-600 disabled:tw-cursor-not-allowed room-btn"
            data-bs-toggle="modal" data-bs-target="#M1" onclick="setRoom(1)"
          >
            1
          </button>
        </div>
      </div>
    </div>
  </div>
</div>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
  let girls = document.getElementById("girls");
  let boys = document.getElementById("boys");
  let idBoys = document.getElementById("id-boys");
  let idGirls = document.getElementById("id-girls");
  let floor = document.getElementById("floor");
  let getBtn = document.getElementById("getDetails");
  let numCells = 0;

  let borg = null;

  function listToMatrix(list, elementsPerSubArray) {
      var matrix = [], i, k;

      for (i = 0, k = -1; i < list.length; i++) {
          if (i % elementsPerSubArray === 0) {
              k++;
              matrix[k] = [];
          }

          matrix[k].push(list[i]);
      }

      return matrix;
  }

function setRoom(gender, hostel_num, floor_num, room_num) {
  let room = document.getElementsByClassName("modal fade")[0];
  room.setAttribute('id', 'M'+String(room_num));
  let images = document.getElementsByClassName('d-block w-100')

  for (let i = 0; i < images.length; i++) {
    images[i].setAttribute('src', '/assets/img/rooms/'+String(gender)+'/'+String(hostel_num)+'/'+String(floor_num)+'/'+String(room_num)+'/'+String(i+1)+'.jpg')
  }

  $('#M'+String(room_num)).modal('show')
}

  function range(n){
    return [...Array(n).keys()]
  }

// Function to generate HTML buttons
function generateButtons(numButtons, rooms_id) {
  const buttonsContainer = document.getElementById(rooms_id);
  
  // Clear any existing buttons
  buttonsContainer.innerHTML = '';

  // Generate buttons
  for (let i = 1; i <= numButtons; i++) {
    const buttonDiv = document.createElement('div');
    buttonDiv.setAttribute('class', 'col');
    
    const button = document.createElement('button');
    button.setAttribute('type', 'button');
    button.setAttribute('class', 'btn tw-bg-gradient-to-r tw-from-green-500 tw-via-green-600 tw-to-green-700 hover:tw-bg-gradient-to-br tw-text-white tw-font-medium disabled:tw-from-red-500 disabled:tw-via-red-600 disabled:tw-to-red-700 disabled:tw-cursor-not-allowed room-btn');
    button.setAttribute('data-bs-target', '#M'+String(i));

    if (borg == 'b') {
      hostel_num = Number(idBoys.getElementsByClassName('form-select')[0].value) / 2
    } else {
      hostel_num = Number(idGirls.getElementsByClassName('form-select')[0].value) / 2
    }

    floor_num = Number(floor.getElementsByClassName('form-select')[0].value) + 1
    button.setAttribute('onclick', 'setRoom("'+String(borg)+'" ,'+String(hostel_num+1)+', '+String(floor_num)+', '+String(i)+')');  
    button.textContent = i;
    
    buttonDiv.appendChild(button);
    buttonsContainer.appendChild(buttonDiv);
  }
}

async function getNumRooms(hostel_id, gender, floor_num) {
// POST request using fetch() 
  const response = await fetch("/api/get_rooms_info", { 
      
      // Adding method type 
      method: "POST", 
        
      // Adding body or contents to send 
      body: JSON.stringify({"hostel_id": hostel_id, "gender": gender, "floor": floor_num}), 
        
      // Adding headers to the request 
      headers: { 
          "Content-type": "application/json; charset=UTF-8"
      } 
  })
  const json = await response.json();

  return json
}

  girls.addEventListener("click", () => {
    borg = 'g';
    idBoys.style.display = "none";
    idGirls.style.display = "inherit";
    floor.style.display = "inherit";
    getBtn.style.display = 'inherit';

    // girls.style.backgroundColor = "orchid";
    // boys.style.backgroundColor = "white";
    girls.classList.add("active");
    boys.classList.remove("active");
  });

  boys.addEventListener("click", () => {
    borg = 'b';
    idGirls.style.display = "none";
    idBoys.style.display = "inherit";
    floor.style.display = "inherit";
    getBtn.style.display = 'inherit';

    // girls.style.backgroundColor = "white";
    // boys.style.backgroundColor = "mediumspringgreen";
    girls.classList.remove("active");
    boys.classList.add("active");
  });


  getBtn.addEventListener("click", () => {
    if (borg == 'b') {
      id = idBoys.getElementsByClassName('form-select')[0].value
    } else {
      id = idGirls.getElementsByClassName('form-select')[0].value
    }
    id = Number(id) + Number(floor.getElementsByClassName('form-select')[0].value)
    console.log(id);
    numCells = getNumRooms(id, borg, floor.getElementsByClassName('form-select')[0].value);

    if (numCells == 0) {
      alert("Please select the number of rooms");
      return
    }
      console.log(id, numCells);
      cellsList = range(numCells);
      console.log(cellsList);
      // createGrid(cellsList, 'rooms_grid');
      generateButtons(numCells, 'rooms_grid');
  });
</script>
{% endblock %}